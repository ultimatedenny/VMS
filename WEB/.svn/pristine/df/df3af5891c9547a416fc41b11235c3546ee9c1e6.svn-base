
<div class="row">
    <div class="col-md-6" id="boxDetailVisitor" hidden="hidden">
        <div class="box ShimanoBox">
            <div class="box-header">
                Detail Visitor
                <div class="box-tools pull-right">
                    <button type="button" class="btn btn-info"
                            title="Change Visitor" id="btnChangeVisitor" data-toggle="modal" onclick="RenderEditData();">
                        Change Visitor <i class="fa fa-edit"></i>
                    </button>
                    <button type="button" class="btn btn-success" onclick="PostUpdateVisitorWhileCheckin()"
                            title="Update Visitor">
                        Update Visitor <i class="fa fa-save"></i>
                    </button>
                    @*<button type="button" class="btn btn-box-tool" data-widget="collapse" data-toggle="tooltip"
                                title="Collapse">
                            <i class="fa fa-minus"></i>
                        </button>*@
                </div>
            </div>
            <div class="box-body">
                <div class="row">
                    <div class="col-md-6">
                        <div class="form-group">
                            @Html.Hidden("detailId")
                            @Html.Label("detailName", "Name : ")<span style="color:red">* Required</span><br />
                            @(Html.Kendo()
                .TextBox()
                .Name("detailName").HtmlAttributes(new { @class = "form-control", @readonly = "readonly" }))
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group">
                            @Html.Label("detailCompany", "Company : ")<span style="color:red">* Required</span><br />
                            @(Html.Kendo()
                .TextBox()
                .Name("detailCompany").HtmlAttributes(new { @class = "form-control", @readonly = "readonly" }))
                        </div>

                    </div>

                </div>
                <div class="row">
                    <div class="col-md-6">
                        <div class="form-group">
                            @Html.Label("detailJobDesc", "Job Description : ")<br />
                            @(Html.Kendo()
                .TextBox()
                .Name("detailJobDesc").HtmlAttributes(new { @class = "form-control" }))
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group">
                            @Html.Label("detailPhone", "Phone Number : ")<span style="color:red">* Required</span><br />
                            @(Html.Kendo()
                .TextBox()
                .Name("detailPhone").HtmlAttributes(new { @class = "form-control" }))
                        </div>

                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6">
                        <div class="form-group">
                            @Html.Label("detailEmail", "Email : ")<br />
                            @(Html.Kendo()
                .TextBox()
                .Name("detailEmail").HtmlAttributes(new { @class = "form-control" }))
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group">
                            @Html.Label("detailVehicleNo", "Vehicle No : ")<br />
                            @(Html.Kendo()
                .TextBox()
                .Name("detailVehicleNo").HtmlAttributes(new { @class = "form-control" }))
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6">
                        <div class="form-group">
                            @Html.Label("detailCardNo", "Card Number : ")<br />
                            @(Html.Kendo()
                .TextBox()
                .Name("detailCardNo").HtmlAttributes(new { @class = "form-control", @readonly = "readonly" }))
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="row" id="rowCreateAppointment" hidden="hidden">
                            <div class="col-md-12 pull-right">
                                <button class="btn btn-warning" id="btnCreateAppointment" onclick="CreateAppointment()"><i class="fa fa-search"></i> Create Appointment</button>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </div>
        <!-- /.box-body -->
    </div>
    <div class="col-md-6" id="boxDetailHost" hidden="hidden">
        <div class="box ShimanoBox">
            <div class="box-header">
                Detail Host
                <div class="box-tools pull-right" id="rwChangeHost" hidden="hidden">
                    <button type="button" class="btn bg-info" onclick="CreateAppointment()"
                            title="Change The Fost">
                        Change Host <i class="fa fa-recycle"></i>
                    </button>
                    @*<button type="button" class="btn btn-box-tool" data-widget="collapse" data-toggle="tooltip"
                                title="Collapse">
                            <i class="fa fa-minus"></i>
                        </button>*@
                </div>
            </div>
            <div class="box-body">
                <div class="row">
                    <div class="col-md-4">
                        <div class="form-group">
                            @Html.Hidden("HostLogId")
                            @Html.Hidden("HostId")
                            @Html.Label("HostName", "Name : ")<br />
                            @(Html.Kendo()
                .TextBox()
                .Name("HostName").HtmlAttributes(new { @class = "form-control", @readonly = "readonly" }))
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="form-group">
                            @Html.Label("HostDepartment", "Department : ")<br />
                            @(Html.Kendo()
                .TextBox()
                .Name("HostDepartment").HtmlAttributes(new { @class = "form-control", @readonly = "readonly" }))
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="form-group">
                            @Html.Label("HostTel", "Ext No. : ")<br />
                            @(Html.Kendo()
                .TextBox()
                .Name("HostTel").HtmlAttributes(new { @class = "form-control", @readonly = "readonly" }))
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-4">
                        <div class="form-group">
                            @Html.Label("AppointmentStart", "Appointment Start : ")<br />
                            @(Html.Kendo()
                .TextBox()
                .Name("AppointmentStart").HtmlAttributes(new { @class = "form-control", @readonly = "readonly" }))
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="form-group">
                            @Html.Label("AppointmentEnd", "Appointment End : ")<br />
                            @(Html.Kendo()
                .TextBox()
                .Name("AppointmentEnd").HtmlAttributes(new { @class = "form-control", @readonly = "readonly" }))
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="form-group">
                            @Html.Label("AppointmentArea", "Area : ")<br />
                            @(Html.Kendo()
                .TextBox()
                .Name("AppointmentArea").HtmlAttributes(new { @class = "form-control", @readonly = "readonly" }))
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-4">
                        <div class="form-group">
                            @Html.Label("VisitorType", "Visitor Type : ")<br />
                            @(Html.Kendo()
                .TextBox()
                .Name("VisitorType").HtmlAttributes(new { @class = "form-control", @readonly = "readonly" }))
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="form-group">
                            @Html.Label("AppointmentStatus", "Status : ")<br />
                            @(Html.Kendo()
                .TextBox()
                .Name("AppointmentStatus").HtmlAttributes(new { @class = "form-control", @readonly = "readonly" }))
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="form-group">
                            @Html.Label("AppointmentRemark", "Remark : ")<br />
                            @(Html.Kendo()
                .TextBox()
                .Name("AppointmentRemark").HtmlAttributes(new { @class = "form-control", @readonly = "readonly" }))
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-4">
                        <button class="btn btn-success" onclick="GetHistoryVisitorById()"><i class="fa fa-history"></i> History Visitor</button>
                    </div>
                </div>

            </div>
        </div>
        <!-- /.box-body -->
    </div>
</div>
<div class="row">
    <div class="col-md-4" id="boxDetailVisitorPhoto" hidden="hidden">
        <div class="box ShimanoBox">
            <div class="box-header">
                Photo Visitor
                <div class="box-tools pull-right">
                    <button type="button" class="btn btn-box-tool" data-widget="collapse" data-toggle="tooltip"
                            title="Collapse">
                        <i class="fa fa-minus"></i>
                    </button>
                </div>
            </div>
            <div class="box-body">

                <div class="row">
                    <div class="col-md-12">
                        <div class="card-img">
                            <img height="200" id="detailPhoto" src="@Url.Content("~/Uploads/PhotoVisitor/no_image.png")" />
                        </div>
                    </div>
                </div><hr />
                <div class="row">
                    <div class="col-md-12">
                        <button class="btn btn-info" id="btnRetakePhoto" onclick="OpenModalTakePhoto()"><i class="fa fa-camera"></i> Retake</button>
                    </div>
                </div>

            </div>
        </div>
        <!-- /.box-body -->
    </div>
    <div class="col-md-4" id="boxDetailRemark" hidden="hidden">
        <div class="box ShimanoBox">
            <div class="box-header">
                Remark Checkin
                <div class="box-tools pull-right">
                    <button type="button" class="btn btn-box-tool" data-widget="collapse" data-toggle="tooltip"
                            title="Collapse">
                        <i class="fa fa-minus"></i>
                    </button>
                </div>
            </div>
            <div class="box-body">
                <div class="row">
                    <div class="col-md-12">
                        @Html.Label("RemarkCheckIn", "Remark :")
                        @Html.Hidden("IsUnknown");
                        @Html.TextArea("RemarkCheckIn", "", 4, 3, new { @class = "k-textbox", style = "width: 100%; padding:10px", required = "required" })
                    </div>
                </div><hr />
                <div class="row">
                    <div class="col-md-12">
                        <button class="btn btn-success" id="BtnSignIn" onclick="SetShimanoBadge()"><i class="fa  fa-sign-in"></i> Sign In</button>
                    </div>
                </div>
            </div>
        </div>
        <!-- /.box-body -->
    </div>
    <div class="col-md-4" id="BoxSignInCard" hidden="hidden">
        <div class="box ShimanoBox">
            <div class="box-header">
                Register Shimano Badge
                <div class="box-tools pull-right">
                    <button type="button" class="btn btn-box-tool" data-widget="collapse" data-toggle="tooltip"
                            title="Collapse">
                        <i class="fa fa-minus"></i>
                    </button>
                </div>
            </div>
            <div class="box-body">
                <div class="row">
                    <div class="col-md-12">
                        <div class="form-group">
                            @Html.Label("CardShimano", "TAP Shimano Badge Card : ")
                            @(Html.Kendo()
                                .TextBox()
                                .Name("CardShimano").HtmlAttributes(new { @class = "form-control k-textboxlarge text-center" }))

                            @*@Html.TextBox("searchName", "", new { @class = "form-control ShimanoBlackBox", required = "required" })*@
                        </div>

                    </div>
                </div>
                <br />
            </div>
        </div>
        <!-- /.box-body -->
    </div>
</div>

<script>
    function fnVisitorCheckin(VisitorId, LogId) {
        DP.AJaxAll({
            VisitorId: VisitorId
        }, "@Url.Action("GetVisitorDetailById", "NewVisitor")", function (data) {
            if (data.Success) {
                visitorname = data.data.FullName;
                $("#detailId").val(VisitorId)
                $("#detailName").val(data.data.FullName)
                $("#detailCompany").val(data.data.Company)
                $("#detailPhone").val(data.data.Phone)
                $("#detailEmail").val(data.data.Email)
                $("#detailJobDesc").val(data.data.JobDesc)
                $("#detailVehicleNo").val(data.data.VehicleNo)
                $("#detailCardNo").val(data.data.VisitorCardNo)
                $("#boxSearchByCard").hide('fast')
                $("#boxSearchByName").hide('fast')
                $("#boxGridName").hide('fast')
                $("#boxDetailVisitor").show('fast')
                $('#boxDetailVisitorPhoto').show("fast")
                var isPhoto = $("#isPhotoMandatory").val()
                if (isPhoto == "true") {
                    CheckPhoto('@Url.Content("~/Uploads/PhotoVisitor/")' + data.data.Photo)
                }
                DP.AJaxAll({
                    LogID: LogId
                }, "@Url.Action("GetisUnknown", "NewVisitor")", function (data) {
                    if (data.Success) {
                        console.log(data.data.AllowUnknown);
                        //$("#IsUnknown").val(data.data.AllowUnknown);
                        //document.getElementById("IsUnknown").value = data.data.AllowUnknown; console.log($("#IsUnknown").val());
                        if (data.data.AllowUnknown == "False") {
                            $("#btnChangeVisitor").toggle(false);
                        }
                        else {
                            $("#btnChangeVisitor").toggle(true);
                        }
                    }
                });
               

            }
        });

        if (LogId != "") {
            fnGetHostAppointment(LogId, VisitorId)


        }
        else {
            $("#rowCreateAppointment").show('fast')
        }

    }
    function fnGetIsUnknown(LogId)
    {
        DP.AJaxAll({
            LogID: LogId
        }, "@Url.Action("GetisUnknown", "NewVisitor")", function (data) {
            if (data.Success) {
                console.log(data.data.AllowUnknown);
                //$("#IsUnknown").val(data.data.AllowUnknown);
                document.getElementById("IsUnknown").value = data.data.AllowUnknown;
            }
        });

    }
    function fnGetHostAppointment(LogId, VisitorId) {
        //console.log(LogId, VisitorId, $("#detailName").val());
        DP.AJaxAll({
            VisitorId:VisitorId,
            LogId : LogId
        }, "@Url.Action("GetHostAppointment", "NewVisitor")", function (data) {
            if (data.Success) {
                $("#HostLogId").val(LogId)
                $("#HostId").val(data.data.UseID)
                $("#HostName").val(data.data.UseNam)
                $("#HostDepartment").val(data.data.UseDep)
                $("#HostTel").val(data.data.UseTel)
                $("#AppointmentStart").val(data.data.TimeStart)
                $("#AppointmentEnd").val(data.data.TimeEnd)
                $("#VisitorType").val(data.data.VisitorType)
                if (data.data.NeedApprove.toUpperCase() == "FALSE") {
                    $("#VisitorType").css("background-color", "#00a65a");
                    $("#VisitorType").css("color", "white");
                }
                else {
                    $("#VisitorType").css("background-color", "#d73925");
                    $("#VisitorType").css("color", "white");
                }
                $("#AppointmentStatus").val(data.data.Status)
                if (data.data.Status == "CHECKOUT") {
                    $("#rwChangeHost").show("fast")
                    $("#boxDetailRemark").show("fast")
                }
                else if (data.data.Status == "APPROVED") {
                    $("#boxDetailRemark").show("fast")
                }
                var isPhoto = $("#isPhotoMandatory").val()
                if (isPhoto != "true") {
                    $("#BoxSignInCard").show('fast')
                }

                $("#AppointmentRemark").val(data.data.Remark)
                $("#AppointmentArea").val(data.data.Area)
                $("#boxDetailHost").show('fast')
            }
        })
    }
    function SetShimanoBadge() {
        $('#BoxSignInCard').show('slow')
        $('#CardShimano').focus()
    }
</script>



<script id="EditVisitor">
    function PostUpdateVisitorWhileCheckin() {
        DP.AJaxAll({
            Visitor: {
                Email: $("#detailEmail").val(),
                Phone: $("#detailPhone").val(),
                id: $("#detailId").val(),
                VehicleNo: $("#detailVehicleNo").val(),
                JobDesc: $("#detailJobDesc").val(),
            }
        }, "@Url.Action("PostUpdateVisitorWhileCheckin", "NewVisitor")", function (data) {
            if (data.Success) {
                toastr.success("Success Update Visitor !", "Succes!")
            }
            else {
                ShiMessage.error("Error!", data.Message)
            }
        })
    }
    function PostsaveToCheckIn() {
        var VisitorId = $("#detailId").val();
        var LogId = $("#HostLogId").val()
        var CardId = $("#CardShimano").val()
        var Remark = $("#RemarkCheckIn").val()
        DP.AJaxAll({
            VisitorId: VisitorId, LogId: LogId, CardId: CardId, Remark: Remark, Method:1
        }, '@Url.Action("PostVisitorCheckinOut", "NewVisitor")', function (data) {
            if (data.Success === true) {
                location.reload();
                toastr.success(data.Message, "success")
            }
            else {
                ShiMessage.error("ERROR!", data.Message);
            }
        })
    }
</script>
<script>
    function RenderEditData() {
        //console.log($("#detailId").val(),
        //            $("#detailName").val(),
        //            $("#detailCompany").val(),
        //            $("#detailPhone").val(),
        //            $("#detailEmail").val(),
        //            $("#detailJobDesc").val(),
        //            $("#detailVehicleNo").val());
        $("#LogIDEdit").val($("#HostLogId").val());
        $("#detailIdEdit").val($("#detailId").val());
        $("#VisitorNameEdit").val($("#detailName").val());
        $("#CompanyEdit").val($("#detailCompany").val());
        $("#JobDescEdit").val($("#detailJobDesc").val());
        $("#EmailEdit").val($("#detailEmail").val());
        $("#PhoneEdit").val($("#detailPhone").val());
        $("#VehicleNoEdit").val($("#detailVehicleNo").val());
        $("#modalEditVisitor").modal("show");
    }
    
</script>